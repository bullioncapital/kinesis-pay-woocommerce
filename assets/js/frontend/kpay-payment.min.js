jQuery(function(e){e(document).ready(()=>{if("undefined"==typeof kpay_data)return!1;const t=kpay_data.kpay_redirect_url,a=kpay_data.kpay_payment_id,o=kpay_data.get_payment_status_action,n=kpay_data.kpay_payment_status,r=kpay_data.timeout_redirect_url,d=kpay_data.rejected_redirect_url,i=kpay_data.error_redirect_url,c=kpay_data.cancel_url,l=kpay_data.messages,s=kpay_data.payment_modal_html,p=kpay_data.timeout_html,y=kpay_data.payment_form_content,m=kpay_data.timeout_peirod?kpay_data.timeout_peirod:6e5;let _=10;e("body").append('<div id="kinesis-pay-modal" style="display: none;"></div>'),document.getElementById("kinesis-pay-modal").innerHTML=s;const u=e("#kinesis-pay-modal");if(!u.length)return alert(l.general_error),window.location=i,!1;const k=document.getElementById("kinesis-pay-modal__kpay-qrcode");if(!k)return alert(l.general_error),window.location=i,!1;new QRCode(k,{text:t,width:160,height:160,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.L}),window.scrollTo(0,0),e("html, body").css({overflow:"hidden",height:"100vh"}),u.show();const f=setTimeout(()=>{clearInterval(w);const e=document.getElementById("kinesis-pay-modal__content");e?e.innerHTML=p:(alert(l.timeout_error),window.location=r)},m),g=document.getElementById("kinesis-pay-modal__check-status-countdown"),w=setInterval(()=>{g.textContent=`${_}s`,_<=0&&(e.ajax({type:"GET",dataType:"json",url:wc_checkout_params.ajax_url,data:{action:o,payment_id:a},success:t=>{if("success"==t.type){const a=t.data;if(a===n.processed){clearInterval(w),clearTimeout(f),e(".kpay-waiting-text").show(),e("#kinesis-pay-modal").hide();const t=e("#kpay-payment-confirm-hidden-form");return t.attr("method","POST"),t.attr("enctype","multipart/form-data"),t.attr("action",kpay_data.callback_url),t.append(y),t.submit(),!1}if(a===n.rejected)return clearInterval(w),clearTimeout(f),alert(l.rejected_error)||(window.location=d),!1;if(a===n.expired){clearInterval(w),clearTimeout(f);const e=document.getElementById("kinesis-pay-modal__content");e?e.innerHTML=p:(alert(l.timeout_error),window.location=r)}}return!1},error:e=>{console.log(`${l.exception_error} ${e.responseJSON&&e.responseJSON.message?e.responseJSON.message:""}`)}}),_=10),_--},1e3),h=document.getElementById("kinesis-pay-modal__cancel-payment-button");h&&h.addEventListener("click",()=>{h.disabled=!0,clearInterval(w),clearTimeout(f),window.location=c})})});const disableCopyButton=e=>{const t=e.textContent;e.textContent=kpay_data?kpay_data.messages.copied:"Copied",e.disabled=!0,setTimeout(()=>{e.textContent=t,e.disabled=!1},2e3)},copyPaymentId=e=>{const t=document.getElementById("kinesis-pay-modal__payment-id-text");navigator.clipboard?navigator.clipboard.writeText(t.value).then(()=>disableCopyButton(e.srcElement)).catch(e=>alert("undefined"==typeof kpay_data?e:`${kpay_data?kpay_data.messages.copy_error:"Failed to copy payment id."} ${e}`)):(t.select(),document.execCommand("Copy"),disableCopyButton(e.srcElement))};